# 🎯 智能止盈止损功能说明

## ✨ 核心特性

### 优先使用信号中的TP/SL
程序会**智能识别**交易员发送的信号中的止盈止损价格，并优先使用这些价格！

---

## 📋 工作原理

### 情况1：信号包含止盈止损 ✓
```
交易员发送：
🚀 BTC/USDT LONG
📍 入场: 42000
🎯 止盈1: 43000
🎯 止盈2: 44000
🛑 止损: 41500
```

**程序会：**
1. ✓ 使用信号止损：41500
2. ✓ 使用信号止盈：43000, 44000
3. ✓ 信号TP占60%仓位（平均分配）
4. ✓ 自动添加额外TP（占40%仓位）
   - TP3: 44520 (基于入场价+6%)

**结果：**
```
📊 订单计划
━━━━━━━━━━━━━━━━━━━━
交易对: BTC/USDT
方向: LONG
入场: 42000

🛑 止损: 41500

🎯 止盈点 (3 个):
  TP1: 43000 (39.5%) ← 信号止盈
  TP2: 44000 (39.5%) ← 信号止盈
  TP3: 44520 (21.1%) ← 额外止盈

📈 追踪止损: 2.0%
⚖️ 保本止损: 盈利 1.0% 后触发
```

---

### 情况2：信号只有止损，没有止盈
```
交易员发送：
🚀 ETH/USDT SHORT
📍 入场: 2200
🛑 止损: 2244
```

**程序会：**
1. ✓ 使用信号止损：2244
2. ✓ 自动生成3个止盈点（使用默认配置）
   - TP1: 2156 (2%利润, 30%仓位)
   - TP2: 2112 (4%利润, 30%仓位)
   - TP3: 2068 (6%利润, 40%仓位)

---

### 情况3：信号没有止盈止损（市价单）
```
交易员发送：
🚀 SOL/USDT LONG
```

**程序会：**
1. ✓ 自动计算止损（默认2%）
2. ✓ 自动生成止盈点（TP1/TP2/TP3）
3. ✓ 市价开仓

---

## ⚙️ 配置说明

### 在GUI中配置
1. 打开 **"⚙️ 详细设置"** 标签
2. 向下滚动找到 **"🎯 止盈止损(TP/SL)设置"**

### 配置项说明

#### 📊 分批止盈（额外TP）
```
TP1: 利润 2%, 仓位 30%
TP2: 利润 4%, 仓位 30%
TP3: 利润 6%, 仓位 40%
```
- 这些TP会在**信号TP之后**添加
- 如果信号没有TP，这些就是主要TP
- 可以修改百分比

#### 🛑 默认止损
```
默认止损: 2.0%
```
- 当信号没有止损时使用
- 从入场价计算

#### 📈 追踪止损
```
☑ 启用追踪止损
追踪百分比: 2.0%
```
- 价格有利时，止损会跟随移动
- 保护已获利润

#### ⚖️ 保本止损
```
☑ 启用保本止损
触发盈利: 1.0%
```
- 当盈利达到1%时
- 止损自动移动到成本价
- 实现保本交易

---

## 💾 保存配置

### 方法：
1. 在 **"⚙️ 详细设置"** 中设置所有参数
2. 向下滚动到底部
3. 点击 **"💾 保存配置到 .env"** 按钮

### 保存内容：
```
✓ .env 文件（基础配置）
✓ tpsl_config.json（止盈止损配置）
```

### 生效时间：
- 重启程序后生效
- 或点击"启动监听"后生效

---

## 📝 实际例子

### 例子1：跟随交易员的TP/SL
```
信号：
💎 #BTC LONG
Entry: 42000
Target 1: 43000
Target 2: 44000  
Stop: 41500

程序执行：
✓ 开多 BTC/USDT @ 42000
✓ 止损: 41500 (来自信号)
✓ TP1: 43000 (30%, 来自信号)
✓ TP2: 44000 (30%, 来自信号)
✓ TP3: 44520 (40%, 程序生成)
✓ 追踪止损激活
```

### 例子2：市价单 + 自动TP/SL
```
信号：
🚀 ETH 做多

程序执行：
✓ 市价开多 ETH/USDT
✓ 止损: -2% (自动计算)
✓ TP1: +2% (30%仓位)
✓ TP2: +4% (30%仓位)
✓ TP3: +6% (40%仓位)
✓ 保本止损: 盈利1%后触发
```

---

## 🎯 最佳实践

### 推荐配置（稳健型）
```
分批止盈：
  TP1: 2% / 30%
  TP2: 4% / 30%
  TP3: 6% / 40%

止损：2.0%

追踪止损：
  ☑ 启用
  百分比：2.0%

保本止损：
  ☑ 启用
  触发：1.0%
```

### 推荐配置（激进型）
```
分批止盈：
  TP1: 3% / 25%
  TP2: 6% / 35%
  TP3: 10% / 40%

止损：3.0%

追踪止损：
  ☑ 启用
  百分比：3.0%

保本止损：
  ☑ 启用
  触发：2.0%
```

---

## 🔍 如何测试

### 1. 在信号测试中验证
```
1. 打开 "🧪 信号测试" 标签
2. 输入测试信号：

🚀 BTC/USDT LONG
入场: 42000
止盈: 43000
止损: 41500

3. 点击 "🔍 解析信号"
4. 查看日志中的订单计划
```

### 2. 查看详细日志
```
在 "📝 实时日志" 中查看：

INFO: 📊 订单计划
INFO: ━━━━━━━━━━━━━━━━━━━━
INFO: 交易对: BTC/USDT
INFO: 方向: LONG
INFO: 入场: 42000
INFO: 
INFO: 🛑 止损: 41500
INFO: 
INFO: 🎯 止盈点 (3 个):
INFO:   TP1: 43000 (39.5%)
INFO:   TP2: 44000 (39.5%)
INFO:   TP3: 44520.0 (21.1%)
```

---

## ❓ 常见问题

### Q1: 信号的TP和程序的TP哪个优先？
**A:** 信号的TP优先！程序的TP作为额外的分批止盈。

### Q2: 如果不想用额外TP怎么办？
**A:** 在配置中把 TP1/TP2/TP3 的"仓位%"都设为0即可。

### Q3: 追踪止损什么时候触发？
**A:** 当价格向有利方向移动时自动触发，始终保持设定的百分比距离。

### Q4: 保本止损会覆盖追踪止损吗？
**A:** 不会，两者配合使用。保本止损先触发，之后追踪止损继续工作。

### Q5: 配置保存不了？
**A:** 确保：
- 所有输入框都填写了值
- 程序有写入权限
- 重启程序后生效

---

## 🎨 界面位置

```
主窗口
├─ 左侧面板
│  ├─ 控制台
│  ├─ 统计信息
│  ├─ 账户余额
│  └─ 配置
│
└─ 右侧标签页
   ├─ 📝 实时日志
   ├─ 🧪 信号测试 ← 在这里测试
   ├─ 📈 交易历史
   └─ ⚙️ 详细设置 ← 在这里配置
      ├─ Telegram 设置
      ├─ 交易所配置
      ├─ 🎯 止盈止损设置 ← 新增！
      │  ├─ 分批止盈
      │  ├─ 默认止损
      │  ├─ 追踪止损
      │  └─ 保本止损
      ├─ 💼 多交易所管理
      └─ 💾 保存配置
```

---

## 📞 技术支持

如有问题：
1. 查看 **"📝 实时日志"** 了解详细信息
2. 在 **"🧪 信号测试"** 中测试信号解析
3. 确认配置已保存到 `tpsl_config.json`

---

**享受智能的止盈止损功能！** 🚀

