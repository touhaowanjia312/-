# 📐 止盈止损百分比计算详解

## 🎯 核心计算公式

### 基本原理
百分比都是**基于入场价格**计算的，确保盈亏计算准确。

---

## 📊 止损计算

### 做多(LONG)的止损
```
止损价格 = 入场价 × (1 - 止损百分比/100)
```

**示例：**
```
入场价: 42000 USDT
止损设置: 2%

止损价格 = 42000 × (1 - 2/100)
         = 42000 × 0.98
         = 41160 USDT

说明：价格跌到 41160 时触发止损
实际亏损：(42000 - 41160) / 42000 = 2%
```

### 做空(SHORT)的止损
```
止损价格 = 入场价 × (1 + 止损百分比/100)
```

**示例：**
```
入场价: 0.02000 USDT (MDT)
止损设置: 2%

止损价格 = 0.02000 × (1 + 2/100)
         = 0.02000 × 1.02
         = 0.02040 USDT

说明：价格涨到 0.02040 时触发止损
实际亏损：(0.02040 - 0.02000) / 0.02000 = 2%
```

---

## 🎯 止盈计算

### 做多(LONG)的止盈
```
止盈价格 = 入场价 × (1 + 止盈百分比/100)
```

**示例：**
```
入场价: 42000 USDT
TP1设置: 2%
TP2设置: 4%
TP3设置: 6%

TP1 = 42000 × (1 + 2/100) = 42000 × 1.02 = 42840 USDT
TP2 = 42000 × (1 + 4/100) = 42000 × 1.04 = 43680 USDT
TP3 = 42000 × (1 + 6/100) = 42000 × 1.06 = 44520 USDT

实际盈利：
TP1: 2%
TP2: 4%
TP3: 6%
```

### 做空(SHORT)的止盈
```
止盈价格 = 入场价 × (1 - 止盈百分比/100)
```

**示例：**
```
入场价: 0.02000 USDT (MDT)
TP1设置: 2%
TP2设置: 4%
TP3设置: 6%

TP1 = 0.02000 × (1 - 2/100) = 0.02000 × 0.98 = 0.01960 USDT
TP2 = 0.02000 × (1 - 4/100) = 0.02000 × 0.96 = 0.01920 USDT
TP3 = 0.02000 × (1 - 6/100) = 0.02000 × 0.94 = 0.01880 USDT

实际盈利：
TP1: 2%
TP2: 4%
TP3: 6%
```

---

## 📈 完整交易示例

### 示例1：BTC 做多
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 BTC/USDT LONG
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

入场价: 42,000 USDT
配置: 
  • 止损: 2%
  • TP1: 2% (30%仓位)
  • TP2: 4% (30%仓位)
  • TP3: 6% (40%仓位)

计算结果：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🛑 止损: 41,160 USDT
   计算: 42000 × (1 - 0.02) = 41,160
   亏损: -2%

🎯 TP1: 42,840 USDT (30%)
   计算: 42000 × (1 + 0.02) = 42,840
   盈利: +2%

🎯 TP2: 43,680 USDT (30%)
   计算: 42000 × (1 + 0.04) = 43,680
   盈利: +4%

🎯 TP3: 44,520 USDT (40%)
   计算: 42000 × (1 + 0.06) = 44,520
   盈利: +6%

预期盈利（全部TP）：
= 2% × 30% + 4% × 30% + 6% × 40%
= 0.6% + 1.2% + 2.4%
= 4.2%
```

### 示例2：MDT 做空（图片信号）
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 MDT/USDT SHORT (市价单)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

成交价: 0.02000 USDT
配置: 
  • 止损: 2%
  • 信号TP: 0.01972 USDT

计算结果：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🛑 止损: 0.02040 USDT
   计算: 0.02000 × (1 + 0.02) = 0.02040
   亏损: -2%

🎯 TP1: 0.01972 USDT (100%)
   来源: 信号提供
   盈利: (0.02000 - 0.01972) / 0.02000 = 1.4%

说明：
• 使用信号提供的止盈价格
• 止损自动计算（成交价+2%）
• 盈利约1.4%
```

### 示例3：ETH 做空（完整配置）
```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 ETH/USDT SHORT
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

入场价: 2,200 USDT
配置: 
  • 止损: 2%
  • TP1: 2% (30%仓位)
  • TP2: 4% (30%仓位)
  • TP3: 6% (40%仓位)

计算结果：
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🛑 止损: 2,244 USDT
   计算: 2200 × (1 + 0.02) = 2,244
   亏损: -2%

🎯 TP1: 2,156 USDT (30%)
   计算: 2200 × (1 - 0.02) = 2,156
   盈利: +2%

🎯 TP2: 2,112 USDT (30%)
   计算: 2200 × (1 - 0.04) = 2,112
   盈利: +4%

🎯 TP3: 2,068 USDT (40%)
   计算: 2200 × (1 - 0.06) = 2,068
   盈利: +6%

预期盈利（全部TP）：
= 2% × 30% + 4% × 30% + 6% × 40%
= 0.6% + 1.2% + 2.4%
= 4.2%
```

---

## 🧮 快速计算表

### 做多(LONG)
| 入场价 | 止损2% | TP1(+2%) | TP2(+4%) | TP3(+6%) |
|--------|--------|----------|----------|----------|
| 10,000 | 9,800  | 10,200   | 10,400   | 10,600   |
| 20,000 | 19,600 | 20,400   | 20,800   | 21,200   |
| 42,000 | 41,160 | 42,840   | 43,680   | 44,520   |
| 50,000 | 49,000 | 51,000   | 52,000   | 53,000   |

### 做空(SHORT)
| 入场价 | 止损2% | TP1(-2%) | TP2(-4%) | TP3(-6%) |
|--------|--------|----------|----------|----------|
| 0.0200 | 0.0204 | 0.0196   | 0.0192   | 0.0188   |
| 0.0850 | 0.0867 | 0.0833   | 0.0816   | 0.0799   |
| 2,200  | 2,244  | 2,156    | 2,112    | 2,068    |
| 42,000 | 42,840 | 41,160   | 40,320   | 39,480   |

---

## ⚖️ 风险回报比

### 配置1：稳健型（默认）
```
止损: 2%
TP1: 2% (30%)
TP2: 4% (30%)
TP3: 6% (40%)

风险: -2%
预期收益: 4.2%
风险回报比: 1:2.1 ✓ 优秀
```

### 配置2：激进型
```
止损: 3%
TP1: 3% (25%)
TP2: 6% (35%)
TP3: 10% (40%)

风险: -3%
预期收益: 6.8%
风险回报比: 1:2.27 ✓ 优秀
```

### 配置3：保守型
```
止损: 1.5%
TP1: 1.5% (40%)
TP2: 3% (40%)
TP3: 4.5% (20%)

风险: -1.5%
预期收益: 2.7%
风险回报比: 1:1.8 ✓ 良好
```

---

## 🔍 在GUI中验证计算

### 测试步骤：
```
1. 打开 "🧪 信号测试"
2. 输入测试信号：

🚀 BTC/USDT LONG
入场: 42000

3. 点击 "🔍 解析信号"
4. 查看日志中的计算结果
```

### 预期输出：
```
INFO: 📊 订单计划
INFO: 交易对: BTC/USDT
INFO: 方向: LONG
INFO: 入场: 42000
INFO: 
INFO: 🛑 止损: 41160.0 ← 42000 × 0.98
INFO: 
INFO: 🎯 止盈点 (3 个):
INFO:   TP1: 42840.0 (30.0%) ← 42000 × 1.02
INFO:   TP2: 43680.0 (30.0%) ← 42000 × 1.04
INFO:   TP3: 44520.0 (40.0%) ← 42000 × 1.06
```

---

## 💡 重要说明

### ✓ 百分比基准
- **始终基于入场价格**
- 不是基于当前价格
- 确保盈亏计算准确

### ✓ 方向区别
- **做多**: 止损在下方，止盈在上方
- **做空**: 止损在上方，止盈在下方

### ✓ 市价单
- 入场价 = 实际成交价
- 止损/止盈基于成交价计算
- 可能有滑点影响

### ✓ 仓位分配
- 每个TP的仓位比例可配置
- 总和必须等于100%
- 默认: 30% + 30% + 40% = 100%

---

## 🎨 公式总结

### 做多(LONG)
```python
止损价 = 入场价 × (1 - 止损% / 100)
止盈价 = 入场价 × (1 + 止盈% / 100)

# 例如：
止损 = 42000 × (1 - 2/100) = 41160
TP1  = 42000 × (1 + 2/100) = 42840
```

### 做空(SHORT)
```python
止损价 = 入场价 × (1 + 止损% / 100)
止盈价 = 入场价 × (1 - 止盈% / 100)

# 例如：
止损 = 0.02000 × (1 + 2/100) = 0.02040
TP1  = 0.02000 × (1 - 2/100) = 0.01960
```

### 实际盈亏验证
```python
做多盈亏% = (平仓价 - 入场价) / 入场价 × 100%
做空盈亏% = (入场价 - 平仓价) / 入场价 × 100%
```

---

## 📞 计算器工具

### 在线计算
可以使用以下公式自己计算：

**做多：**
- 止损 = 入场价 × (1 - 止损%/100)
- 止盈 = 入场价 × (1 + 止盈%/100)

**做空：**
- 止损 = 入场价 × (1 + 止损%/100)
- 止盈 = 入场价 × (1 - 止盈%/100)

### Excel公式
```excel
做多止损: =A1*(1-B1/100)
做多止盈: =A1*(1+B1/100)
做空止损: =A1*(1+B1/100)
做空止盈: =A1*(1-B1/100)

其中：
A1 = 入场价格
B1 = 百分比（例如：2）
```

---

**现在你完全理解计算原理了！** 📐✨

